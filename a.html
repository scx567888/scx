<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>大文件上传测试（fetch）</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 600px;
            margin: 2em auto;
        }
        input[type="file"] {
            margin-bottom: 1em;
        }
        progress {
            width: 100%;
            height: 20px;
        }
    </style>
</head>
<body>

<h2>上传文件（使用 fetch + multipart/form-data）</h2>

<input type="file" id="fileInput"><br>
<button onclick="upload()">上传</button>

<p id="status"></p>
<progress id="progressBar" value="0" max="100"></progress>

<script>
    async function upload() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];
        const status = document.getElementById('status');
        const progressBar = document.getElementById('progressBar');

        if (!file) {
            status.textContent = "请先选择一个文件";
            return;
        }

        status.textContent = "准备上传...";
        progressBar.value = 0;

        // 构造 multipart/form-data 请求体
        const formData = new FormData();
        formData.append('file', file);

        try {
            const response = await fetch('http://localhost:8080/upload', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                status.textContent = "上传成功！";
                progressBar.value = 100;
            } else {
                status.textContent = `上传失败，状态码：${response.status}`;
            }
        } catch (err) {
            status.textContent = "上传失败：" + err;
        }
    }
</script>

</body>
</html>
